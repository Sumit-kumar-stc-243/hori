<link rel="stylesheet" href="{{ 'swiper-min.css' | asset_url }}">
<script src="{{ 'swiper.min.js' | asset_url }}" defer></script>

<div id="peek-swiper-{{ section.id }}">
  <div class="peek-swiper-container">
    <div class="swiper peek-swiper">
      <div class="swiper-wrapper">
        {% for slide in block %}
          {% content_for 'blocks' %}
        {% endfor %}
      </div>

      <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
    </div>
  </div>
</div>

{% style %}
  #peek-swiper-{{ section.id }} {
    --swiper-image-ratio: {{ section.settings.image_ratio }}%;
    --swiper-width: {{ section.settings.desktop_width }}%;
    --swiper-inactive-scale: {{ section.settings.inactive_scale | divided_by: 100 }};
    --swiper-mobile-width: {{ section.settings.mobile_width }}%;
    --swiper-mobile-inactive-scale: {{ section.settings.mobile_inactive_scale | divided_by: 100 }};
  }

  #peek-swiper-{{ section.id }} .peek-swiper-container {
    position: relative;
    width: 100%;
    display: flex;
    align-items: center;
  }

  #peek-swiper-{{ section.id }} .peek-swiper {
    position: relative;
    width: 100%;
    height: calc(var(--swiper-width) * var(--swiper-image-ratio) / 100%);
    overflow: hidden;
  }

  #peek-swiper-{{ section.id }} .swiper-slide {
    position: relative;
    width: var(--swiper-width);
    opacity: 0.5;
    transform: scale(var(--swiper-inactive-scale));
    transition: all 0.3s ease-in-out;
    border-radius: 8px;
    overflow: hidden;
  }

  #peek-swiper-{{ section.id }} .swiper-slide-active {
    transform: scale(1) !important;
    opacity: 1 !important;
  }

  #peek-swiper-{{ section.id }} .peek-swiper-image {
    position: relative;
    width: 100%;
    padding-top: var(--swiper-image-ratio)%;
  }

  #peek-swiper-{{ section.id }} .peek-swiper-image img {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  #peek-swiper-{{ section.id }} .swiper-button-next,
  #peek-swiper-{{ section.id }} .swiper-button-prev {
    width: 28px;
    height: 28px;
    background: rgba(0,0,0,0.4);
    border-radius: 50%;
  }

  #peek-swiper-{{ section.id }} .swiper-button-next::after,
  #peek-swiper-{{ section.id }} .swiper-button-prev::after {
    font-size: 12px;
    color: #fff;
  }

  #peek-swiper-{{ section.id }} .swiper-button-next {
    right: calc((100% - var(--swiper-width)) / 2);
  }

  #peek-swiper-{{ section.id }} .swiper-button-prev {
    left: calc((100% - var(--swiper-width)) / 2);
  }

  @media (max-width: 768px) {
    #peek-swiper-{{ section.id }} .peek-swiper {
      height: calc(var(--swiper-mobile-width) * var(--swiper-image-ratio) / 100%);
    }

    #peek-swiper-{{ section.id }} .swiper-slide {
      width: var(--swiper-mobile-width);
      transform: scale(var(--swiper-mobile-inactive-scale));
    }

    #peek-swiper-{{ section.id }} .swiper-button-next {
      right: calc((100% - var(--swiper-mobile-width)) / 2);
    }

    #peek-swiper-{{ section.id }} .swiper-button-prev {
      left: calc((100% - var(--swiper-mobile-width)) / 2);
    }
  }
{% endstyle %}

<script>
  document.addEventListener('DOMContentLoaded', function() {
      const swiperContainer = document.querySelector('#peek-swiper-{{ section.id }} .peek-swiper');
      if(!swiperContainer) return;

      new Swiper(swiperContainer, {
        slidesPerView: 'auto',
        centeredSlides: true,
        autoplay: {
          delay: {{ section.settings.autoplay_delay | default: 5000 }},
          disableOnInteraction: true
        },
        navigation: {
          nextEl: '#peek-swiper-{{ section.id }} .swiper-button-next',
          prevEl: '#peek-swiper-{{ section.id }} .swiper-button-prev'
        }
      });
    });
</script>

{% schema %}
{
  "name": "Peek Swiper Slider",
  "settings": [
    {
      "type": "range",
      "id": "desktop_width",
      "label": "Desktop slide width (%)",
      "min": 30,
      "max": 80,
      "step": 1,
      "default": 50
    },
    {
      "type": "range",
      "id": "mobile_width",
      "label": "Mobile slide width (%)",
      "min": 70,
      "max": 100,
      "step": 1,
      "default": 90
    },
    {
      "type": "range",
      "id": "image_ratio",
      "label": "Image ratio (%)",
      "min": 20,
      "max": 80,
      "step": 1,
      "default": 33
    },
    {
      "type": "range",
      "id": "inactive_scale",
      "label": "Inactive slide scale (desktop, 0-100%)",
      "min": 50,
      "max": 100,
      "step": 1,
      "default": 85
    },
    {
      "type": "range",
      "id": "mobile_inactive_scale",
      "label": "Inactive slide scale (mobile, 0-100%)",
      "min": 50,
      "max": 100,
      "step": 1,
      "default": 95
    },
    {
      "type": "number",
      "id": "autoplay_delay",
      "label": "Autoplay delay (ms)",
      "default": 5000
    }
  ],
  "blocks": [
    {
      "type": "swiper-slide"
    }
  ],
  "presets": [
    {
      "name": "Peek Swiper Slider"
    }
  ]
}
{% endschema %}
