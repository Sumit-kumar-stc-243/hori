<style>
  .custom-button-wrapper {
    position: relative;
    display: inline-block;
  }

  .corner-border {
    position: absolute;
    height: 8px;
    width: 8px;
    border: 0.5px solid #EE3224;
    border-right: none;
    border-bottom: none;
    border-radius: 2px;
    display: none;
    pointer-events: none;
  }

  .corner-border.left   { top: 5px; left: 5px; }
  .corner-border.top    { top: 5px; right: 5px; transform: rotate(90deg); }
  .corner-border.right  { bottom: 5px; right: 5px; transform: rotate(180deg); }
  .corner-border.bottom { bottom: 5px; left: 5px; transform: rotate(270deg); }

  #shopify-section-{{ section.id }} .custom-button#{{ block.id }} {
    background-color: {{ block.settings.background_color }};
    color: {{ block.settings.text_color }};
    font-size: {{ block.settings.font_size }}px;
    font-weight: {{ block.settings.font_weight }};
    padding: {{ block.settings.padding }};
    border-radius: {{ block.settings.border_radius }}px;
    border: {{ block.settings.border_width }}px solid {{ block.settings.border_color }};
    cursor: pointer;
  }

  #shopify-section-{{ section.id }} .custom-button.active#{{ block.id }} {
    background: {{ block.settings.active_background_color }};
    color: {{ block.settings.active_text_color }};
    border: none;
    border-bottom: 1px solid #EE3224;
  }
</style>

<div class="custom-button-wrapper">
  <button class="custom-button" id="{{ block.id }}">
    {{ block.settings.label }}
  </button>

  {% if block.settings.show_all_btn_or_not != 'noBorder' %}
    <span class="corner-border left"></span>
    <span class="corner-border top"></span>
    <span class="corner-border right"></span>
    <span class="corner-border bottom"></span>
  {% endif %}
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const section = document.querySelector('#shopify-section-{{ section.id }}');
    if (!section) return;

    const mode = "{{ block.settings.show_all_btn_or_not }}";
    const wrappers = section.querySelectorAll('.custom-button-wrapper');

    function hideAllBorders() {
      wrappers.forEach(w =>
        w.querySelectorAll('.corner-border').forEach(b => b.style.display = 'none')
      );
    }

    function showBorders(wrapper) {
      wrapper.querySelectorAll('.corner-border')
        .forEach(b => b.style.display = 'block');
    }

    // ✅ Initial state
    wrappers.forEach(w => w.querySelector('.custom-button').classList.remove('active'));
    wrappers[0].querySelector('.custom-button').classList.add('active');

    if (mode === 'Show All') {
      wrappers.forEach(showBorders);
    }

    if (mode === 'activeBtn') {
      hideAllBorders();
      showBorders(wrappers[0]);
    }

    // ✅ Click handling
    wrappers.forEach(wrapper => {
      const button = wrapper.querySelector('.custom-button');

      button.addEventListener('click', () => {
        wrappers.forEach(w => w.querySelector('.custom-button').classList.remove('active'));
        button.classList.add('active');

        if (mode === 'activeBtn') {
          hideAllBorders();
          showBorders(wrapper);
        }
      });
    });
  });
</script>

{% schema %}
{
  "name": "Custom Button",
  "settings": [
    {
      "type": "text",
      "id": "label",
      "label": "Button Label",
      "default": "Shop Now"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#ffffff"
    },
    {
      "type": "number",
      "id": "font_size",
      "label": "Font Size",
      "default": 16
    },
    {
      "type": "number",
      "id": "font_weight",
      "label": "Font Weight",
      "default": 400
    },
    {
      "type": "text",
      "id": "padding",
      "label": "Padding",
      "default": "10px 20px"
    },
    {
      "type": "number",
      "id": "border_radius",
      "label": "Border Radius",
      "default": 0
    },
    {
      "type": "number",
      "id": "border_width",
      "label": "Border Width",
      "default": 1
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border Color"
    },
    {
      "type": "color_background",
      "id": "active_background_color",
      "label": "Active Background",
      "default": "linear-gradient(#000, #333)"
    },
    {
      "type": "color",
      "id": "active_text_color",
      "label": "Active Text Color",
      "default": "#ffffff"
    },
    {
      "type": "select",
      "id": "show_all_btn_or_not",
      "label": "Corner Border Display",
      "options": [
        { "value": "Show All", "label": "Show All Buttons" },
        { "value": "activeBtn", "label": "Active Button Only" },
        { "value": "noBorder", "label": "No Border" }
      ],
      "default": "activeBtn"
    }
  ],
  "presets": [
    {
      "name": "Custom Button"
    }
  ]
}
{% endschema %}
